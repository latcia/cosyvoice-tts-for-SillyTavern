**一个功能强大的 SillyTavern TTS 扩展，支持 CosyVoice 预设角色和即时语音克隆**

[功能特性](#-功能特性) • [安装指南](#-安装指南) • [使用说明](#-使用说明) • [配置选项](#️-配置选项) • [常见问题](#-常见问题)

</div>

---

## ✨ 功能特性

### 🎭 双模式支持

| 模式 | 描述 | 适用场景 |
|------|------|----------|
| **预设角色** | 使用 CosyVoice 预配置的语音角色 | 快速使用，无需额外配置 |
| **即时克隆** | 上传参考音频实现声音克隆 | 自定义角色声音 |

### 🔧 核心功能

- **📝 自定义引号提取** - 支持多种引号样式，只朗读对话内容
  - 日式「」
  - 西式 ""
  - 中式 ""
  - 法式 «»
  - 单引号 ''
  - 双角引号『』
  - 自定义引号

- **💾 克隆预设管理** - 保存参考音频+文本组合，快速切换不同声音

- **⚡ 并行预生成** - 提前生成后续音频，减少播放间隔

- **🎛️ 悬浮控制球** - 便捷的播放控制界面
  - ▶️ 播放
  - ⏸️ 暂停/继续
  - ⏹️ 停止
  - ⚙️ 设置

- **🔄 自动播放** - 新消息自动触发 TTS 播放

---

## 📦 安装指南

### 前置要求

1. **SillyTavern** 版本 1.10.0 或更高
2. **CosyVoice API 服务** 运行中（默认端口 9880）

### 安装步骤

#### 方法一：Git Clone（推荐）

```bash
cd SillyTavern/public/scripts/extensions/third-party
git clone https://github.com/latcia/cosyvoice-tts-for-SillyTavern.git

#### 方法二：手动安装

1. 下载本仓库的 ZIP 文件
2. 解压到 `SillyTavern/public/scripts/extensions/third-party/st-cosyvoice-tts/`
3. 确保目录结构如下：

```
st-cosyvoice-tts/
├── manifest.json
├── index.js
├── style.css
└── README.md
```

### 启用扩展

1. 启动/重启 SillyTavern
2. 进入 **扩展** 面板
3. 找到 **CosyVoice TTS** 并启用
4. 右侧会出现悬浮控制球

---

## 📖 使用说明

### 快速开始

#### 使用预设角色

1. 点击悬浮球的 ⚙️ 打开设置
2. 确认 API 地址正确（默认 `http://localhost:9880`）
3. 点击 **测试** 验证连接
4. 在 **TTS 模式** 选择 **预设角色**
5. 从下拉列表选择角色
6. 关闭设置，点击 ▶️ 播放

#### 使用即时克隆

1. 打开设置，选择 **即时克隆** 模式
2. 点击 **选择音频文件** 上传参考音频（3-10秒最佳）
3. 在 **参考文本** 输入音频对应的文字内容
4. 可选：点击 **保存为克隆预设** 保存配置
5. 关闭设置，点击 ▶️ 播放

### 引号设置

扩展会自动提取引号内的对话内容进行朗读：

```
角色说道：「这是会被朗读的内容。」这部分旁白不会朗读。

「多段对话也支持。」
「会按顺序播放。」
```

如需朗读全部内容，取消勾选 **只提取引号内内容**。

### 播放控制

| 按钮 | 功能 | 状态说明 |
|------|------|----------|
| ▶️ 播放 | 开始播放最新AI消息 | - |
| 🔊 播放中 | 当前正在播放 | 显示为播放状态 |
| ⏳ 生成中 | 正在生成音频 | 按钮禁用 |
| ⏸️ 暂停 | 暂停当前播放 | - |
| ▶️ 继续 | 恢复播放 | 暂停状态下显示 |
| ⏹️ 停止 | 完全停止并清理 | - |

---

## ⚙️ 配置选项

### API 设置

| 选项 | 默认值 | 说明 |
|------|--------|------|
| API 地址 | `http://localhost:9880` | CosyVoice 服务地址 |
| 语速 | 1.0 | 范围 0.5 - 2.0 |

### 引号设置

| 选项 | 默认值 | 说明 |
|------|--------|------|
| 只提取引号内内容 | ✅ 开启 | 关闭后朗读全部文本 |
| 引号样式 | 日式「」 | 选择或自定义引号 |

### 功能开关

| 选项 | 默认值 | 说明 |
|------|--------|------|
| 启用扩展 | ✅ 开启 | 控制扩展是否工作 |
| 自动播放 | ❌ 关闭 | 新消息自动触发播放 |

### 高级设置

| 选项 | 默认值 | 说明 |
|------|--------|------|
| 预加载数量 | 3 | 提前生成的音频段数 |

---

## 🔌 API 兼容性

本扩展调用以下 CosyVoice API 端点：

| 端点 | 方法 | 用途 |
|------|------|------|
| `/speakers` | GET | 获取预设角色列表 |
| `/` | POST | 使用预设角色生成语音 |
| `/api/tts_zero_shot` | POST | 即时克隆生成语音 |
| `/api/health` | GET | 连接测试 |

### 请求示例

**预设角色模式：**
```json
POST /
{
    "text": "你好，世界",
    "speaker": "角色名称",
    "speed": 1.0
}
```

**即时克隆模式：**
```json
POST /api/tts_zero_shot
{
    "text": "你好，世界",
    "prompt_text": "参考音频的文本内容",
    "prompt_wav": "base64编码的音频数据",
    "speed": 1.0,
    "mode": "零样本复制",
    "instruction": ""
}
```

---

## ❓ 常见问题

### Q: 连接测试失败

**A:** 请检查：
1. CosyVoice 服务是否正在运行
2. API 地址是否正确（注意端口号）
3. 防火墙是否阻止了连接
4. 如使用 Docker，确认端口映射正确

### Q: 没有获取到角色列表

**A:** 
1. 点击 **刷新** 按钮重新获取
2. 确认 CosyVoice 已配置预设角色
3. 检查 `/speakers` 接口是否正常响应

### Q: 音频生成很慢

**A:**
1. 增加 **预加载数量** 提前生成更多音频
2. 检查服务器性能和网络延迟
3. 使用更短的文本分段

### Q: 即时克隆效果不好

**A:**
1. 使用 3-10 秒的清晰参考音频
2. 确保参考文本与音频内容完全匹配
3. 避免有背景音乐或噪音的音频
4. 尝试不同的克隆模式

### Q: 引号内容没有被正确提取

**A:**
1. 确认使用了正确的引号样式
2. 检查是否有全角/半角混用问题
3. 尝试使用自定义引号并手动指定

---

## 📝 更新日志

### v1.1.0
- ✨ 新增预设角色支持
- ✨ 新增并行预生成功能
- 🔧 完善悬浮球控制按钮
- 🎨 优化 UI 交互体验

### v1.0.0
- 🎉 初始版本发布
- ✨ 即时克隆功能
- ✨ 自定义引号提取
- ✨ 克隆预设管理

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

1. Fork 本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建 Pull Request

---

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件

---

## 🙏 致谢

- [SillyTavern](https://github.com/SillyTavern/SillyTavern) - 优秀的 AI 聊天前端
- [CosyVoice](https://github.com/FunAudioLLM/CosyVoice) - 强大的语音合成模型

---

<div align="center">

**如果这个项目对你有帮助，请给个 ⭐ Star 支持一下！**

Made with ❤️ for the SillyTavern Community

</div>
```

---

这个 README 包含了：

1. **徽章和标题** - 版本、兼容性、许可证信息
2. **功能特性** - 详细的功能列表和对比表格
3. **安装指南** - 两种安装方式的详细步骤
4. **使用说明** - 快速开始指南和操作说明
5. **配置选项** - 所有可配置项的说明表格
6. **API 兼容性** - API 端点和请求格式说明
7. **常见问题** - FAQ 解答常见问题
8. **更新日志** - 版本历史
9. **贡献指南** - 如何参与项目
10. **致谢** - 相关项目链接

您可以根据实际的 GitHub 仓库地址修改链接！
